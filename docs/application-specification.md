# 廃棄品見積もりアプリケーション仕様書

## 1. 概要

### 1.1 アプリケーション目的
廃棄品（家具、家電等）の見積もり作成から作業指示書生成までのワークフローを支援するWebアプリケーションです。顧客からの不用品廃棄依頼を効率的に処理し、見積書と作業指示書を生成します。

### 1.2 対象ユーザー
- 廃棄品処理業者のスタッフ
- 顧客対応窓口担当者
- 現場作業員

### 1.3 システム構成
- フロントエンド: Next.js (React)
- 認証: 基本的に認証なし（LIFF化が容易な場合のみ実装）
- データ保存: PDF・スプレッドシートのみ（データベース保存なし）
- 外部連携: Google Drive、Google Spreadsheet

## 2. 機能仕様

### 2.1 メイン画面（顧客情報・廃棄品選択）

#### 2.1.1 顧客情報入力
**必須項目**
- 顧客名
- 住所
- 電話番号
- メールアドレス
- 廃棄予定日

#### 2.1.2 廃棄品選択機能
**選択方法（3パターン）**
1. **カテゴリ別選択**
   - 椅子
   - 机・テーブル
   - タンス・収納
   - 家電製品
   - ベッド・寝具
   - その他

2. **イニシャル別選択**
   - あ行の商品
   - か行の商品
   - さ行の商品
   - た行の商品
   - な行の商品
   - は行の商品
   - ま行の商品
   - や行の商品
   - ら行の商品
   - わ行の商品

3. **検索機能**
   - 商品名での絞り込み検索
   - 部分一致検索対応

#### 2.1.3 アイテム管理
- 既存アイテムの選択
- カスタムアイテムの追加
- 数量の設定
- 価格の調整
- 写真の添付

#### 2.1.4 リアルタイム計算
- 選択アイテムの合計金額表示
- 数量・価格変更時の自動再計算

### 2.2 確認画面（見積もり確認・生成）

#### 2.2.1 情報確認
- 顧客情報の確認表示
- 選択廃棄品一覧の表示
- 合計金額の表示
- 担当者名の入力

#### 2.2.2 見積書生成
- 見積書PDF生成機能
- 生成後のGoogle Drive連携
- 見積書テンプレート使用（提供されたテンプレートを基準）

**見積書テンプレート項目**
- 顧客情報
- 廃棄品リスト（品名、数量、単価、金額）
- 合計金額
- 担当者名
- 作成日

### 2.3 作業指示書画面

#### 2.3.1 基本情報
- 顧客情報の再表示
- 廃棄品リストの表示
- 合計金額の表示

#### 2.3.2 作業指示書入力項目
**必須項目**
- 作業伝票
- 計量
- マニフェスト
- リサイクル券
- 集金額
- Tポイント
- 収集日時
- 備考・特記事項

#### 2.3.3 指示書生成
- 作業指示書の生成
- Google Spreadsheet連携
- 指示書テンプレート使用（提供されたテンプレートを基準）

## 3. ユーザーフロー

### 3.1 基本フロー
```
1. メイン画面
   ├── 顧客情報入力
   ├── 廃棄品選択（カテゴリ/イニシャル/検索）
   ├── 数量・価格設定
   └── 確認画面へ遷移

2. 確認画面  
   ├── 入力内容確認
   ├── 担当者名入力
   ├── 見積書生成
   ├── Google Drive連携
   └── 作業指示書画面へ遷移

3. 作業指示書画面
   ├── 作業詳細入力
   ├── 指示書生成
   └── Google Spreadsheet連携
```

### 3.2 画面遷移
- メイン画面 → 確認画面 → 作業指示書画面
- 各画面から前の画面への戻り機能
- 外部リンクによるテンプレート確認

## 4. データ仕様

### 4.1 顧客情報
```typescript
interface CustomerInfo {
  name: string;           // 顧客名
  address: string;        // 住所
  phone: string;          // 電話番号
  email: string;          // メールアドレス
  disposalDate: string;   // 廃棄予定日
  assignedStaff?: string; // 担当者名
}
```

### 4.2 廃棄品アイテム
```typescript
interface Item {
  id: string;             // アイテムID
  name: string;           // 品名
  category: string;       // カテゴリ
  basePrice: number;      // 基本価格
  initial: string;        // イニシャル（あ行、か行等）
}

interface SelectedItem extends Item {
  quantity: number;       // 数量
  customPrice?: number;   // カスタム価格
  imageUrl?: string;      // 画像URL
  notes?: string;         // 備考
}
```

### 4.3 作業指示書
```typescript
interface WorkInstruction {
  workTicket: string;     // 作業伝票
  weighing: string;       // 計量
  manifest: string;       // マニフェスト
  recycleTicket: string;  // リサイクル券
  collectionAmount: number; // 集金額
  tPoints: number;        // Tポイント
  collectionDate: string; // 収集日時
  notes: string;          // 備考
}
```

## 5. 認証・セキュリティ

### 5.1 認証方式
- **基本方針**: 認証機能は設けない
- **例外**: LIFF化が簡単に実装できる場合のみ実装
- **禁止事項**: メール+パスワード認証は実装しない

### 5.2 LIFF化オプション
**実装可能な場合**
- LINE LIFF (LINE Front-end Framework) 使用
- スプレッドシートでID管理
- 登録者名の自動入力
- LINEOrderのような仕組み

**スプレッドシート仕様**
- 担当者ID管理
- 担当者名とLINE IDの紐付け
- 権限レベル設定（必要に応じて）

## 6. データ保存・外部連携

### 6.1 データ保存方針
- **見積書**: PDFファイルのみ保存
- **作業指示書**: Google Spreadsheetのみ保存
- **アプリケーションデータ**: データベース保存なし
- **一時データ**: LocalStorage使用

### 6.2 外部連携

#### 6.2.1 Google Drive
- 見積書PDF保存
- 提供されたテンプレートURL: [見積書テンプレート](https://docs.google.com/spreadsheets/d/11Wi1h8zC_m5S5nIJe-FO5ZvE8L1C-z_u/edit?usp=sharing&ouid=110988423713000796184&rtpof=true&sd=true)

#### 6.2.2 Google Spreadsheet
- 作業指示書データ保存
- 提供されたテンプレートURL: [指示書テンプレート](https://docs.google.com/spreadsheets/d/1I9M0ODpbEhxcOMIkHZ4pGNBzYuw4fczW/edit?usp=drive_link&ouid=110988423713000796184&rtpof=true&sd=true)

## 7. 価格表管理

### 7.1 価格データ保存方式
**要検討事項**: 価格表の保存方法は以下から選択

#### 7.1.1 オプション1: Firestore使用
- **特徴**: ユーザーが簡単に変更できない
- **メリット**: データの整合性・セキュリティが高い
- **デメリット**: 価格変更時の手間
- **変更頻度**: 低頻度での価格変更に適している

#### 7.1.2 オプション2: スプレッドシート使用
- **特徴**: ユーザーが簡単に変更可能
- **メリット**: 価格変更が容易
- **デメリット**: データの整合性に注意が必要
- **変更頻度**: 頻繁な価格変更に適している

### 7.2 推奨方式
価格変更の頻度と運用体制に応じて選択：
- **低頻度変更**: Firestore推奨
- **高頻度変更**: スプレッドシート推奨

## 8. 技術仕様

### 8.1 フロントエンド技術スタック
- **フレームワーク**: Next.js 15.x (App Router)
- **言語**: TypeScript
- **UI**: Tailwind CSS + shadcn/ui
- **状態管理**: React Hooks + LocalStorage
- **フォーム**: react-hook-form + zod
- **アイコン**: Lucide React

### 8.2 外部サービス連携
- **Google Drive API**: 見積書PDF保存
- **Google Sheets API**: 作業指示書データ保存
- **LINE LIFF**: 認証機能（オプション）

### 8.3 データベース
- **基本方針**: データベース不使用
- **価格データ**: Firestore または スプレッドシート
- **一時データ**: LocalStorage

## 9. 画面設計

### 9.1 メイン画面
- **レイアウト**: 3カラム構成
  - 左: 顧客情報入力
  - 中央: 廃棄品選択（タブ切り替え）
  - 右: 選択済みアイテム・合計金額
- **廃棄品選択タブ**: カテゴリ/イニシャル/検索
- **レスポンシブ**: モバイル対応

### 9.2 確認画面
- **情報表示**: 顧客情報・選択アイテム一覧
- **担当者入力**: 担当者名入力フィールド
- **アクション**: 見積書生成・指示書画面遷移

### 9.3 作業指示書画面
- **基本情報**: 顧客・アイテム情報表示
- **作業詳細**: 6項目の入力フォーム
- **アクション**: 指示書生成・保存

## 10. 運用仕様

### 10.1 ワークフロー
1. 顧客からの依頼受付
2. メイン画面での情報入力
3. 確認画面での見積書生成
4. 作業指示書画面での作業詳細入力
5. 現場作業員への指示書共有

### 10.2 ファイル管理
- **見積書PDF**: Google Drive保存
- **作業指示書**: Google Spreadsheet保存
- **画像ファイル**: 一時保存（LocalStorage）

### 10.3 品質管理
- **データ検証**: 入力項目の必須チェック
- **エラーハンドリング**: 外部API連携エラー対応
- **バックアップ**: 外部サービス依存によるデータ保護

## 11. 今後の拡張可能性

### 11.1 機能拡張
- 顧客履歴管理
- 統計・分析機能
- 売上管理機能
- スケジュール管理

### 11.2 技術拡張
- PWA対応
- オフライン機能
- プッシュ通知
- 多言語対応

### 11.3 連携拡張
- 会計システム連携
- CRMシステム連携
- 在庫管理システム連携

## 12. 実装優先度

### 12.1 高優先度（MVP）
- [ ] 顧客情報入力機能
- [ ] 廃棄品選択機能（3パターン）
- [ ] 見積書生成機能
- [ ] 作業指示書生成機能
- [ ] Google Drive/Spreadsheet連携

### 12.2 中優先度
- [ ] 画像アップロード機能
- [ ] 価格調整機能
- [ ] データ検証・エラーハンドリング
- [ ] レスポンシブデザイン

### 12.3 低優先度（オプション）
- [ ] LIFF認証機能
- [ ] 履歴管理機能
- [ ] 統計機能
- [ ] PWA対応

---

**作成日**: 2025年6月16日  
**バージョン**: 1.0  
**基準ドキュメント**: moc-app-with-v0調査レポート、プロダクトマネージャーフィードバック